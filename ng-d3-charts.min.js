!function(a,b){"use strict";if("function"==typeof define&&define.amd)define(["angular"],b);else{if("undefined"==typeof module||"object"!=typeof module.exports)return b(a.angular);module.exports=b(require("angular"))}}(this,function(angular){"use strict";var moduleName="ng-d3-charts",mod=angular.module(moduleName,[]);return mod.service("d3Loader",["$document","$q","$rootScope",function(a,b,c){function d(){c.$apply(function(){e.resolve(window.d3)})}var e=b.defer(),f=a[0].createElement("script");f.type="text/javascript",f.async=!0,f.src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js",f.onreadystatechange=function(){"complete"==this.readyState&&d()},f.onload=d;var g=a[0].getElementsByTagName("body")[0];return g.appendChild(f),{d3:function(){return e.promise}}}]),mod.factory("chartConfig",function(){var a=function(a){this.chartType=a.chartType||null,this.margin=a.margin||{top:30,right:30,bottom:30,left:30},this.barPadding=a.barPadding||.5,this.barOuterPadding=a.barOuterPadding||.2,this.showXaxis=a.showXaxis||!0,this.showYaxis=a.showYaxis||!0,this.barColor=a.barColor||"#3498DB",this.bakcgroundColor=a.bakcgroundColor||"white",this.delayedEntrance=a.delayedEntrance||100};return a}),mod.directive("ngBarChart",["d3Loader","$timeout",function(d3Loader,$timeout){function barChart(config,data,element,attrs){var margin=config.margin,full_width=attrs.$$element[0].parentNode.clientWidth,full_height=attrs.$$element[0].parentNode.offsetHeight,width=full_width-margin.left-margin.right,height=full_height-margin.top-margin.bottom,bar_padding=config.barPadding,bar_outer_padding=config.barOuterPadding,barColor=config.barColor,backgroundColor=config.bakcgroundColor,colorScale;config.barColor.indexOf("d3.scale")>-1&&(colorScale=eval(config.barColor));var x=d3.scale.ordinal().rangeRoundBands([0,width],bar_padding,bar_outer_padding),y=d3.scale.linear().range([height,0]),x_axis=d3.svg.axis().scale(x).outerTickSize(0).orient("bottom"),y_axis=d3.svg.axis().scale(y).tickSize(6).outerTickSize(0).orient("left"),x_domain=[];angular.forEach(data,function(a,b){x_domain.push(a.x)}),x.domain(x_domain);var max_y=d3.max(data,function(a){return a.y});y.domain([0,1.1*max_y]);var svgNotExist=null==d3.select(element[0]).select("svg").select("g")[0][0];!!config.showYaxis&&(margin=leftMarginToBiggestYLabelWidth(element,y_axis,margin));var mask,x_axis_node,y_axis_node,initial,svg;svgNotExist?(svg=d3.select(element[0]).append("svg:svg").attr("width",full_width).attr("height",full_height).attr("class","bar-chart").append("svg:g").attr("transform","translate("+margin.left+","+margin.top+")"),initial=!0):svg=d3.select(element[0]).select("svg g");var bar_nodes=svg.selectAll(".bar").data(data);bar_nodes.exit().remove(),bar_nodes.enter().append("rect").attr("class","bar").attr("y",function(a){return y(0)}),bar_nodes.style("fill",function(a,b){return void 0!=colorScale?colorScale(b):barColor}),bar_nodes.transition().duration(300).attr("x",function(a){return x(a.x)}).attr("y",function(a,b){return y(a.y)}).attr("width",x.rangeBand()).attr("height",function(a){return height-y(a.y)}).delay(function(a,b){return b*config.delayedEntrance}),svg.select(".axis.x").remove(),mask=svg.append("rect").attr("class","mask").attr("y",height).attr("x",0).attr("width",width).attr("height",margin.bottom).style("fill",backgroundColor),x_axis_node=svg.append("g").attr("class","axis x").attr("transform","translate(0,"+height+")"),!!initial&&(y_axis_node=svg.append("g").attr("class","axis y").attr("transform","translate(0,0)"),initial=!1),!!config.showXaxis&&svg.select(".x.axis").transition().duration(300).call(x_axis),!!config.showYaxis&&svg.select(".y.axis").transition().duration(300).call(y_axis)}function lineChart(a,b,c,d){var e=a.margin,f=d.$$element[0].parentNode.clientWidth,g=d.$$element[0].parentNode.offsetHeight,h=f-e.left-e.right,i=g-e.top-e.bottom,j=d3.scale.linear().range([0,h]),k=d3.scale.linear().range([i,0]),l=d3.svg.axis().scale(j).tickSize(6).outerTickSize(0).orient("bottom");j.domain(d3.extent(b,function(a){return a.x}));var m=d3.svg.axis().scale(k).tickSize(6).outerTickSize(0).orient("left");k.domain(d3.extent(b,function(a){return a.y}));var n,o,p,q,r=null==d3.select(c[0]).select("svg").select("g")[0][0];!!a.showYaxis&&(e=leftMarginToBiggestYLabelWidth(c,m,e)),r?(q=d3.select(c[0]).append("svg:svg").attr("class","line-chart").attr("width",f).attr("height",g).append("svg:g").attr("transform","translate("+e.left+","+e.top+")"),p=!0):q=d3.select(c[0]).select("svg g");var s=d3.svg.line().x(function(a){return j(a.x)}).y(function(a){return k(a.y)});p?(n=q.append("g").attr("class","x axis").attr("transform","translate(0,"+i+")").call(l),n.append("text").style("text-anchor","end").style("font-size",".6em").attr("dx",h-5+"px").attr("dy","1.5em").text(a.XlabelText),o=q.append("g").attr("class","y axis").call(m),o.append("text").attr("class","axis-label").attr("transform","rotate(-90)").attr("y",6).attr("dy",".6em").style("text-anchor","end").style("font-size",".6em").text(a.YlabelText),q.append("path").attr("class","line").attr("d",s(b))):(q.select(".x.axis").transition().duration(750).call(l),q.select(".y.axis").transition().duration(750).call(m),q.select(".line").transition().duration(750).attr("d",s(b)))}function leftMarginToBiggestYLabelWidth(a,b,c){var d,e;return d=b.scale().tickFormat(),e=d3.select(a[0]).append("text").text(d(b.scale().ticks()[b.scale().ticks().length-1])),c.left<1.5*e[0][0].offsetWidth&&(console.info("refactoring margin"),c.left=1.5*e[0][0].offsetWidth),e.remove(),c}return{restrict:"E",scope:{dataset:"=",config:"="},link:function(scope,element,attrs){var d3isReady=d3Loader.d3();scope.$watch("dataset",function(newData,oldData){!!newData&&d3isReady.then(function(){$timeout(function(){var chartToDraw=eval(scope.config.chartType);chartToDraw?chartToDraw(scope.config,newData,element,attrs):console.error("Invalid chart name. Please adjust your chartType parameter.")})})})}}}]),moduleName});