!function(a,b){"use strict";if("function"==typeof define&&define.amd)define(["angular"],b);else{if("undefined"==typeof module||"object"!=typeof module.exports)return b(a.angular);module.exports=b(require("angular"))}}(this,function(a){"use strict";var b="ng-d3-charts",c=a.module(b,[]);return c.service("d3Loader",["$document","$q","$rootScope",function(a,b,c){function d(){c.$apply(function(){e.resolve(window.d3)})}var e=b.defer(),f=a[0].createElement("script");f.type="text/javascript",f.async=!0,f.src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js",f.onreadystatechange=function(){"complete"==this.readyState&&d()},f.onload=d;var g=a[0].getElementsByTagName("body")[0];return g.appendChild(f),{d3:function(){return e.promise}}}]),c.factory("chartConfig",function(){var a=function(a){this.margin=a.margin||{top:30,right:30,bottom:30,left:30},this.barPadding=a.barPadding||.5,this.barOuterPadding=a.barOuterPadding||.2,this.showXaxis=!0,this.showYaxis=!1,this.barColor=a.barColor||"#3498DB",this.bakcgroundColor=a.bakcgroundColor||"white",this.delayedEntrance=a.delayedEntrance||100};return a}),c.directive("ngBarChart",["d3Loader","$timeout",function(b,c){function d(b,c,d,e){function f(){var a,b;return a=s.scale().tickFormat(),b=d3.select(d[0]).append("text").text(a(s.scale().ticks()[s.scale().ticks().length-1])),g.left<1.5*b[0][0].offsetWidth&&(g.left=1.5*b[0][0].offsetWidth),b.remove(),!0}var g=b.margin,h=e.$$element[0].parentElement.clientWidth,i=e.$$element[0].parentElement.clientHeight,j=h-g.left-g.right,k=i-g.top-g.bottom,l=b.barPadding,m=b.barOuterPadding,n=b.barColor,o=b.bakcgroundColor,p=d3.scale.ordinal().rangeRoundBands([0,j],l,m),q=d3.scale.linear().range([k,0]),r=d3.svg.axis().scale(p).outerTickSize(0).orient("bottom"),s=d3.svg.axis().scale(q).tickSize(6).outerTickSize(0).orient("left"),t=[];a.forEach(c,function(a,b){t.push(a.x)}),p.domain(t);var u=d3.max(c,function(a){return a.y});q.domain([0,1.1*u]);var v=null==d3.select(d[0]).select("svg").select("g")[0][0];!!b.showYaxis&&f();var w,x,y,z,A;v?(A=d3.select(d[0]).append("svg:svg").attr("width",h).attr("height",i).append("svg:g").attr("transform","translate("+g.left+","+g.top+")"),z=!0):A=d3.select(d[0]).select("svg g");var B=A.selectAll(".bar").data(c);B.exit().remove(),B.enter().append("rect").attr("class","bar").style("fill",function(a){return n}).attr("y",function(a){return q(0)}),B.transition().duration(300).attr("x",function(a){return p(a.x)}).attr("y",function(a,b){return q(a.y)}).attr("width",p.rangeBand()).attr("height",function(a){return k-q(a.y)}).delay(function(a,c){return c*b.delayedEntrance}),A.select(".axis.x").remove(),w=A.append("rect").attr("class","mask").attr("y",k).attr("x",0).attr("width",j).attr("height",g.bottom).style("fill",o),x=A.append("g").attr("class","axis x").attr("transform","translate(0,"+k+")"),!!z&&(y=A.append("g").attr("class","axis y").attr("transform","translate(0,0)"),z=!1),!!b.showXaxis&&A.select(".x.axis").transition().duration(300).call(r),!!b.showYaxis&&A.select(".y.axis").transition().duration(300).call(s)}return{restrict:"E",scope:{dataset:"=",config:"="},link:function(a,e,f){var g=b.d3();a.$watch("dataset",function(b,h){!!b&&g.then(function(){c(function(){d(a.config,b,e,f)})})})}}}]),b});