!function(a,b){"use strict";if("function"==typeof define&&define.amd)define(["angular"],b);else{if("undefined"==typeof module||"object"!=typeof module.exports)return b(a.angular);module.exports=b(require("angular"))}}(this,function(angular){"use strict";var moduleName="ng-d3-charts",mod=angular.module(moduleName,[]);return mod.service("d3Loader",["$document","$q","$rootScope",function(a,b,c){function d(){c.$apply(function(){e.resolve(window.d3)})}var e=b.defer(),f=a[0].createElement("script");f.type="text/javascript",f.async=!0,f.src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js",f.onreadystatechange=function(){"complete"==this.readyState&&d()},f.onload=d;var g=a[0].getElementsByTagName("body")[0];return g.appendChild(f),{d3:function(){return e.promise}}}]),mod.factory("chartConfig",function(){var a=function(a){this.margin=a.margin||{top:30,right:30,bottom:30,left:30},this.barPadding=a.barPadding||.5,this.barOuterPadding=a.barOuterPadding||.2,this.showXaxis=a.showXaxis||!0,this.showYaxis=a.showYaxis||!0,this.barColor=a.barColor||"#3498DB",this.bakcgroundColor=a.bakcgroundColor||"white",this.delayedEntrance=a.delayedEntrance||100};return a}),mod.directive("ngBarChart",["d3Loader","$timeout",function(d3Loader,$timeout){function drawBarChart(config,data,element,attrs){function leftMarginToBiggestYLabelWidth(){var a,b;return a=y_axis.scale().tickFormat(),b=d3.select(element[0]).append("text").text(a(y_axis.scale().ticks()[y_axis.scale().ticks().length-1])),margin.left<1.5*b[0][0].offsetWidth&&(margin.left=1.5*b[0][0].offsetWidth),b.remove(),!0}var margin=config.margin,full_width=attrs.$$element[0].parentElement.clientWidth,full_height=attrs.$$element[0].parentElement.clientHeight,width=full_width-margin.left-margin.right,height=full_height-margin.top-margin.bottom,bar_padding=config.barPadding,bar_outer_padding=config.barOuterPadding,barColor=config.barColor,backgroundColor=config.bakcgroundColor,colorScale;config.barColor.indexOf("d3.scale")>-1&&(colorScale=eval(config.barColor));var x=d3.scale.ordinal().rangeRoundBands([0,width],bar_padding,bar_outer_padding),y=d3.scale.linear().range([height,0]),x_axis=d3.svg.axis().scale(x).outerTickSize(0).orient("bottom"),y_axis=d3.svg.axis().scale(y).tickSize(6).outerTickSize(0).orient("left"),x_domain=[];angular.forEach(data,function(a,b){x_domain.push(a.x)}),x.domain(x_domain);var max_y=d3.max(data,function(a){return a.y});y.domain([0,1.1*max_y]);var svgNotExist=null==d3.select(element[0]).select("svg").select("g")[0][0];!!config.showYaxis&&leftMarginToBiggestYLabelWidth();var mask,x_axis_node,y_axis_node,initial,svg;svgNotExist?(svg=d3.select(element[0]).append("svg:svg").attr("width",full_width).attr("height",full_height).append("svg:g").attr("transform","translate("+margin.left+","+margin.top+")"),initial=!0):svg=d3.select(element[0]).select("svg g");var bar_nodes=svg.selectAll(".bar").data(data);bar_nodes.exit().remove(),bar_nodes.enter().append("rect").attr("class","bar").attr("y",function(a){return y(0)}),bar_nodes.style("fill",function(a,b){return void 0!=colorScale?colorScale(b):barColor}),bar_nodes.transition().duration(300).attr("x",function(a){return x(a.x)}).attr("y",function(a,b){return y(a.y)}).attr("width",x.rangeBand()).attr("height",function(a){return height-y(a.y)}).delay(function(a,b){return b*config.delayedEntrance}),svg.select(".axis.x").remove(),mask=svg.append("rect").attr("class","mask").attr("y",height).attr("x",0).attr("width",width).attr("height",margin.bottom).style("fill",backgroundColor),x_axis_node=svg.append("g").attr("class","axis x").attr("transform","translate(0,"+height+")"),!!initial&&(y_axis_node=svg.append("g").attr("class","axis y").attr("transform","translate(0,0)"),initial=!1),!!config.showXaxis&&svg.select(".x.axis").transition().duration(300).call(x_axis),!!config.showYaxis&&svg.select(".y.axis").transition().duration(300).call(y_axis)}return{restrict:"E",scope:{dataset:"=",config:"="},link:function(a,b,c){var d=d3Loader.d3();a.$watch("dataset",function(e,f){!!e&&d.then(function(){$timeout(function(){drawBarChart(a.config,e,b,c)})})})}}}]),moduleName});